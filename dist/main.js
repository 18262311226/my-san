(()=>{"use strict";var e={STRING:1,NUMBER:2,BOOL:3,ACCESSOR:4,INTERP:5,CALL:6,TEXT:7,BINARY:8,UNARY:9,TERTIARY:10,OBJECT:11,ARRAY:12,NULL:13};function r(e){var r=e.match(/\s*([\$0-9a-z_]+)/gi,1);if(!r)throw new Error("[SAN FATAL] expect an ident: "+e.source.slice(e.index));return r[1]}function t(n){n.goUntil();var a=n.source.charCodeAt(n.index);switch(a){case 33:case 43:case 45:return n.index++,function(r,t){switch(t){case 33:var n;switch(r.type){case e.NUMBER:case e.STRING:case e.BOOL:n=!r.value;break;case e.ARRAY:case e.OBJECT:n=!1;break;case e.NULL:n=!0}if(null!=n)return{type:e.BOOL,value:n};break;case 43:switch(r.type){case e.NUMBER:case e.STRING:case e.BOOL:return{type:e.NUMBER,value:+r.value}}break;case 45:switch(r.type){case e.NUMBER:case e.STRING:case e.BOOL:return{type:e.NUMBER,value:-r.value}}}return{type:e.UNARY,expr:r,operator:t}}(t(n),a);case 34:case 39:return function(r){var t,n=r.source.charCodeAt(r.index),a="";e:for(;t=r.nextCode();)switch(t){case 92:switch(t=r.nextCode()){case 117:a+=String.fromCharCode(parseInt(r.source.slice(r.index+1,r.index+5),16)),r.index+=4;break;case 120:a+=String.fromCharCode(parseInt(r.source.slice(r.index+1,r.index+3),16)),r.index+=2;break;case 98:a+="\b";break;case 102:a+="\f";break;case 110:a+="\n";break;case 114:a+="\r";break;case 116:a+="\t";break;case 118:a+="\v";break;default:a+=String.fromCharCode(t)}break;case n:r.index++;break e;default:a+=String.fromCharCode(t)}return{type:e.STRING,value:a}}(n);case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return{type:e.NUMBER,value:+n.match(/[0-9]+(\.[0-9]+)?/g,1)[0]};case 40:return function(e){e.index++;var r=c(e);return e.goUntil(41),r.parenthesized=!0,r}(n);case 91:n.index++;for(var s=[];!n.goUntil(93);){var o={};s.push(o),46===n.source.charCodeAt(n.index)&&n.match(/\.\.\.\s*/g)&&(o.spread=!0),o.expr=c(n),n.goUntil(44)}return{type:e.ARRAY,items:s};case 123:n.index++;for(var i=[];!n.goUntil(125);){if(o={},i.push(o),46===n.source.charCodeAt(n.index)&&n.match(/\.\.\.\s*/g))o.spread=!0,o.expr=c(n);else{var u=n.index;if(o.name=t(n),o.name.type>4)throw new Error("[SAN FATAL] unexpect object name: "+n.source.slice(u,n.index));n.goUntil(58)?o.expr=c(n):o.expr=o.name,o.name.type===e.ACCESSOR&&(o.name=o.name.paths[0])}n.goUntil(44)}return{type:e.OBJECT,items:i}}return function(t,n){t.goUntil();var a,s=function(t){var n=r(t);switch(n){case"true":case"false":return{type:e.BOOL,value:"true"===n};case"null":return{type:e.NULL}}var a={type:e.ACCESSOR,paths:[{type:e.STRING,value:n}]};e:for(;;)switch(t.source.charCodeAt(t.index)){case 46:t.index++,a.paths.push({type:e.STRING,value:r(t)});break;case 91:t.index++,a.paths.push(c(t)),t.goUntil(93);break;default:break e}return a}(t);if(t.goUntil(40))for(a=[];!t.goUntil(41);)a.push(c(t)),t.goUntil(44);else n&&(a=n);return a&&(s={type:e.CALL,name:s,args:a}),s}(n)}function n(r){for(var n=t(r);;){r.goUntil();var a=r.source.charCodeAt(r.index);switch(a){case 37:case 42:case 47:r.index++,n={type:e.BINARY,operator:a,segs:[n,t(r)]};continue}break}return n}function a(r){for(var t=n(r);;){r.goUntil();var a=r.source.charCodeAt(r.index);switch(a){case 43:case 45:r.index++,t={type:e.BINARY,operator:a,segs:[t,n(r)]};continue}break}return t}function s(r){var t=a(r);r.goUntil();var n=r.source.charCodeAt(r.index);switch(n){case 60:case 62:return 61===r.nextCode()&&(n+=61,r.index++),{type:e.BINARY,operator:n,segs:[t,a(r)]}}return t}function o(r){var t=function(r){var t=s(r);r.goUntil();var n=r.source.charCodeAt(r.index);switch(n){case 61:case 33:if(61===r.nextCode())return n+=61,61===r.nextCode()&&(n+=61,r.index++),{type:e.BINARY,operator:n,segs:[t,s(r)]};r.index--}return t}(r);if(r.goUntil(),38===r.source.charCodeAt(r.index)){if(38===r.nextCode())return r.index++,{type:e.BINARY,operator:76,segs:[t,o(r)]};r.index--}return t}function i(r){var t=o(r);if(r.goUntil(),124===r.source.charCodeAt(r.index)){if(124===r.nextCode())return r.index++,{type:e.BINARY,operator:248,segs:[t,i(r)]};r.index--}return t}function c(r){var t=i(r);if(r.goUntil(),63===r.source.charCodeAt(r.index)){r.index++;var n=c(r);if(r.goUntil(),58===r.source.charCodeAt(r.index))return r.index++,{type:e.TERTIARY,segs:[t,n,c(r)]}}return t}function u(e){this.source=e,this.len=e.length,this.index=0}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e){if(e)return"object"===p(e)&&e.type?e:c(new u(e))}function l(e,r){for(var t in r)if(r.hasOwnProperty(t)){var n=r[t];void 0!==n&&(e[t]=n)}return e}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function y(e){if("object"===h(e)){var r="";for(var t in e)e.hasOwnProperty(t)&&(r+=t+":"+e[t]+";");return r}return e}u.prototype.nextCode=function(){return this.index++,this.source.charCodeAt(this.index)},u.prototype.goUntil=function(e){for(var r;this.index<this.len&&(r=this.source.charCodeAt(this.index));)switch(r){case 32:case 9:case 13:case 10:this.index++;break;default:return r===e?(this.index++,1):void 0}},u.prototype.match=function(e,r){e.lastIndex=this.index;var t=e.exec(this.source);if(console.log("match",t),t&&(!r||this.index===t.index))return this.index=e.lastIndex,t};var d={url:encodeURIComponent,_class:function(e){return e instanceof Array?e.join(" "):e},_style:y,_xclass:function(e,r){return e instanceof Array&&(e=e.join(" ")),e?r?r+" "+e:e:r},_xstyle:function(e,r){return(e=e&&y(e))?r?r+";"+e:e:r}};function v(e,r,t){for(var n=[],a=0;a<e.length;a++)n.push(b(e[a],r,t));return n}function x(e,r,t){for(var n=r;n;){if("function"==typeof n.error)return void n.error(e,r,t);n=n.parentComponent}throw e}function b(r,t,n){if(null!=r.value)return r.value;var a;switch(r.type){case e.NULL:return null;case e.UNARY:switch(a=b(r.expr,t,n),r.operator){case 33:a=!a;break;case 43:a=+a;break;case 45:a=0-a}return a;case e.BINARY:a=b(r.segs[0],t,n);var s=b(r.segs[1],t,n);switch(r.operator){case 37:a%=s;break;case 43:a+=s;break;case 45:a-=s;break;case 42:a*=s;break;case 47:a/=s;break;case 60:a=a<s;break;case 62:a=a>s;break;case 76:a=a&&s;break;case 94:a=a!=s;break;case 121:a=a<=s;break;case 122:a=a==s;break;case 123:a=a>=s;break;case 155:a=a!==s;break;case 183:a=a===s;break;case 248:a=a||s}return a;case e.TERTIARY:return b(r.segs[b(r.segs[0],t,n)?1:2],t,n);case e.ARRAY:a=[];for(var o=0;o<r.items.length;o++){var i=r.items[o],c=b(i.expr,t,n);i.spread?c&&(a=a.concat(c)):a.push(c)}return a;case e.OBJECT:a={};for(var u=0;u<r.items.length;u++){var p=r.items[u],f=b(p.expr,t,n);p.spread?f&&l(a,f):a[b(p.name,t,n)]=f}return a;case e.INTERP:if(a=b(r.expr,t,n),n)for(var h=0;h<r.filters.length;h++){var y=r.filters[h],g=y.name.paths[0].value;switch(g){case"url":case"_class":case"_style":a=d[g](a);break;case"_xclass":case"_xstyle":a=d[g](a,b(y.args[0],t,n));break;default:try{a=n.filters[g]&&n.filters[g].apply(n,[a].concat(v(y.args,t,n)))}catch(e){x(e,n,"filter:"+g)}}}return null==a&&(a=""),a;case e.CALL:if(n&&r.name.type===e.ACCESSOR){for(var A=n,C=r.name.paths.length,R=0;A&&R<C;R++)A=A[b(r.name.paths[R],t,n)];A&&(a=A.apply(n,v(r.args,t,n)))}break;case e.TEXT:for(var m="",k=0;k<r.segs.length;k++){var S=r.segs[k];m+=S.value||b(S,t,n)}return m}return a}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function A(e,r){this.parent=r,this.raw=e||{},this.listeners=[]}function C(r,t,n,a,s,o){if(n>=a)return s;null==r&&(r={});var i=t[n],c=b(i,o),u=r;if(r instanceof Array){var p=+c;c=isNaN(p)?c:p,(u=r.slice(0))[c]=C(r[c],t,n+1,a,s,o)}else if("object"===g(r)){u={};var f=!0;for(var l in r)r.hasOwnProperty(l)&&(l===c?(f=!1,u[c]=C(r[c],t,n+1,a,s,o)):u[l]=u[l]);f&&(u[c]=C(r[c],t,n+1,a,s,o))}return null==i.value&&(t[n]={type:"string"==typeof c?e.STRING:e.NUMBER,value:c}),u}A.prototype.checkDataTypes=function(){this.typeChecker&&this.typeChecker(this.raw)},A.prototype.setTypeChecker=function(e){this.typeChecker=e},Date.prototype.listen=function(e){},Date.prototype.unlisten=function(e){},A.prototype.fire=function(e){},A.prototype.get=function(e,r){var t=this.raw;if(!e)return t;"object"!==g(e)&&(e=f(e));var n=e.paths;if(r=r||this,void 0===(t=t[n[0].value])&&this.parent)t=this.parent.get(e,r);else for(var a=1,s=n.length;null!==t&&a<s;a++)t=t[n[a].value||b(n[a],r)];return t},A.prototype.set=function(r,t,n){n=n||{};var a=r;if((r=f(r)).type!==e.ACCESSOR)throw new Error("[SAN ERROR] Invalid Expression in Data set: "+a);if(this.get(r)!==t||n.force){var s=(r={type:e.ACCESSOR,paths:r.paths.slice(0)}).paths[0].value;this.raw[s]=C(this.raw[s],r.paths,1,r.paths.length,t,this),this.fire({type:1,expr:r,value:t,option:n}),this.checkDataTypes()}};var R={version:"1.0.0",parseExpr:f,ExprType:e,Data:A,evalExpr:b};"undefined"!=typeof window&&(window.san=R)})();
//# sourceMappingURL=main.js.map